<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carousel Responsivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --rgba-verde-05-main: rgba(34, 197, 94, 0.1);
            --rgba-amarillo-01-main: rgba(251, 191, 36, 0.2);
            --rgba-verde-1-main: rgba(34, 197, 94, 0.2);
            --rgba-amarillo-03-main: rgba(251, 191, 36, 0.4);
            --rgba-amarillo-02-main: rgba(251, 191, 36, 0.3);
            --rgba-amarillo-05-main: rgba(251, 191, 36, 0.6);
            --c-gris-claro-main: #e5e7eb;
            --c-amarillo3-main: #fbbf24;
        }

        /* Carousel Styles */
        .carousel-container {
            background: var(--rgba-verde-05-main);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--rgba-amarillo-01-main);
        }

        .carousel-track {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .carousel-item {
            flex: 0 0 auto;
            width: 300px;
            margin-right: 24px;
        }

        .carousel-item:last-child {
            margin-right: 0;
        }

        .carousel-arrow {
            background: var(--rgba-verde-1-main);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--rgba-amarillo-03-main);
            transition: all 0.3s ease;
            color: var(--c-gris-claro-main);
        }

        .carousel-arrow:hover {
            background: var(--rgba-amarillo-02-main);
            border-color: var(--rgba-amarillo-05-main);
            color: var(--c-amarillo3-main);
        }

        .carousel-arrow:active {
            transform: scale(0.95);
        }

        .carousel-arrow:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .product-title {
            color: white;
            font-weight: 600;
        }

        .product-price {
            color: var(--c-amarillo3-main);
            font-weight: 700;
            font-size: 1.25rem;
        }

        /* Responsive adjustments */
        @media (max-width: 1280px) {
            .carousel-item {
                width: 280px;
            }
        }

        @media (max-width: 1024px) {
            .carousel-item {
                width: 260px;
                margin-right: 20px;
            }
        }

        @media (max-width: 768px) {
            .carousel-item {
                width: 240px;
                margin-right: 16px;
            }
        }

        @media (max-width: 640px) {
            .carousel-item {
                width: 280px;
                margin-right: 12px;
            }
        }
    </style>
</head>
<body class="bg-gray-900">

<section class="carousel-container rounded-3xl p-8 relative mb-10 mx-4 mt-8">
    <!-- Navigation Arrows -->
    <button
        class="carousel-arrow absolute left-2 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center z-20 transition-all duration-300"
        id="prevBtn">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
    </button>

    <button
        class="carousel-arrow absolute right-2 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center z-20 transition-all duration-300"
        id="nextBtn">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
    </button>

    <!-- Carousel Header -->
    <div class="w-full flex justify-center items-center mb-6">
        <h2 class="text-2xl sm:text-3xl md:text-4xl text-white font-bold">PRODUCTOS SIMILARES</h2>
    </div>

    <!-- Carousel Container -->
    <div class="overflow-hidden mx-8">
        <div class="carousel-track" id="carouselTrack">
            <!-- Demo products -->
            <div class="carousel-item">
                <div class="product-card rounded-2xl p-6 h-full cursor-pointer" onclick="goToProduct(this)">
                    <div class="product-image mb-6">
                        <img src="https://via.placeholder.com/300x200/4CAF50/ffffff?text=Producto+1" 
                             alt="Producto 1" 
                             class="w-full h-48 object-contain rounded-xl bg-white">
                    </div>
                    <h3 class="product-title text-xl leading-tight h-16 mb-4">
                        Producto Demo 1 - Descripción Larga
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="product-price">$299.99</span>
                            <div class="flex items-center space-x-1 text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs text-white">En stock</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="product-card rounded-2xl p-6 h-full cursor-pointer" onclick="goToProduct(this)">
                    <div class="product-image mb-6">
                        <img src="https://via.placeholder.com/300x200/2196F3/ffffff?text=Producto+2" 
                             alt="Producto 2" 
                             class="w-full h-48 object-contain rounded-xl bg-white">
                    </div>
                    <h3 class="product-title text-xl leading-tight h-16 mb-4">
                        Producto Demo 2 - Otro Producto
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="product-price">$199.99</span>
                            <div class="flex items-center space-x-1 text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs text-white">En stock</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="product-card rounded-2xl p-6 h-full cursor-pointer" onclick="goToProduct(this)">
                    <div class="product-image mb-6">
                        <img src="https://via.placeholder.com/300x200/FF9800/ffffff?text=Producto+3" 
                             alt="Producto 3" 
                             class="w-full h-48 object-contain rounded-xl bg-white">
                    </div>
                    <h3 class="product-title text-xl leading-tight h-16 mb-4">
                        Producto Demo 3 - Excelente Calidad
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="product-price">$399.99</span>
                            <div class="flex items-center space-x-1 text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs text-white">En stock</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="product-card rounded-2xl p-6 h-full cursor-pointer" onclick="goToProduct(this)">
                    <div class="product-image mb-6">
                        <img src="https://via.placeholder.com/300x200/E91E63/ffffff?text=Producto+4" 
                             alt="Producto 4" 
                             class="w-full h-48 object-contain rounded-xl bg-white">
                    </div>
                    <h3 class="product-title text-xl leading-tight h-16 mb-4">
                        Producto Demo 4 - Premium
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="product-price">$499.99</span>
                            <div class="flex items-center space-x-1 text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs text-white">En stock</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="product-card rounded-2xl p-6 h-full cursor-pointer" onclick="goToProduct(this)">
                    <div class="product-image mb-6">
                        <img src="https://via.placeholder.com/300x200/9C27B0/ffffff?text=Producto+5" 
                             alt="Producto 5" 
                             class="w-full h-48 object-contain rounded-xl bg-white">
                    </div>
                    <h3 class="product-title text-xl leading-tight h-16 mb-4">
                        Producto Demo 5 - Edición Especial
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="product-price">$599.99</span>
                            <div class="flex items-center space-x-1 text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs text-white">En stock</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-item">
                <div class="product-card rounded-2xl p-6 h-full cursor-pointer" onclick="goToProduct(this)">
                    <div class="product-image mb-6">
                        <img src="https://via.placeholder.com/300x200/607D8B/ffffff?text=Producto+6" 
                             alt="Producto 6" 
                             class="w-full h-48 object-contain rounded-xl bg-white">
                    </div>
                    <h3 class="product-title text-xl leading-tight h-16 mb-4">
                        Producto Demo 6 - Último Item
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="product-price">$699.99</span>
                            <div class="flex items-center space-x-1 text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-xs text-white">En stock</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
class ModernCarousel {
    constructor() {
        this.track = document.getElementById('carouselTrack');
        this.prevBtn = document.getElementById('prevBtn');
        this.nextBtn = document.getElementById('nextBtn');
        this.items = Array.from(this.track.children);
        this.currentIndex = 0;
        this.totalItems = this.items.length;
        
        // Configuración responsive
        this.itemsPerView = this.getItemsPerView();
        this.itemWidth = this.getItemWidth();
        
        // Calcular el máximo índice permitido - CORREGIDO
        this.maxIndex = this.calculateMaxIndex();
        
        this.init();
        this.setupEventListeners();
        this.updateButtons();
    }

    getItemsPerView() {
        const width = window.innerWidth;
        if (width >= 1280) return 4;      // xl: 4 items
        if (width >= 1024) return 3;      // lg: 3 items  
        if (width >= 768) return 2;       // md: 2 items
        return 1;                         // sm: 1 item
    }

    getItemWidth() {
        if (this.items.length === 0) return 0;
        
        const width = window.innerWidth;
        let itemWidth, gap;
        
        if (width >= 1280) {
            itemWidth = 300;
            gap = 24;
        } else if (width >= 1024) {
            itemWidth = 280;
            gap = 20;
        } else if (width >= 768) {
            itemWidth = 260;
            gap = 20;
        } else if (width >= 640) {
            itemWidth = 280;
            gap = 12;
        } else {
            itemWidth = 240;
            gap = 16;
        }
        
        return itemWidth + gap;
    }

    calculateMaxIndex() {
        if (this.totalItems <= this.itemsPerView) {
            return 0; // No hay necesidad de scroll si todos los items caben
        }
        return this.totalItems - this.itemsPerView;
    }

    init() {
        this.updateCarousel();
    }

    setupEventListeners() {
        this.prevBtn.addEventListener('click', () => this.prev());
        this.nextBtn.addEventListener('click', () => this.next());

        // Manejo de resize con debounce
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                this.handleResize();
            }, 250);
        });

        // Touch support para móviles
        this.setupTouchEvents();
    }

    setupTouchEvents() {
        let startX = 0;
        let isDragging = false;
        
        this.track.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
        });

        this.track.addEventListener('touchend', (e) => {
            if (!isDragging) return;
            
            const endX = e.changedTouches[0].clientX;
            const diff = startX - endX;
            
            if (Math.abs(diff) > 50) { // Mínimo swipe de 50px
                if (diff > 0) {
                    this.next();
                } else {
                    this.prev();
                }
            }
            
            isDragging = false;
        });
    }

    handleResize() {
        this.itemsPerView = this.getItemsPerView();
        this.itemWidth = this.getItemWidth();
        this.maxIndex = this.calculateMaxIndex();
        
        // Ajustar currentIndex si excede el nuevo límite
        this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
        
        this.updateCarousel();
        this.updateButtons();
    }

    prev() {
        if (this.currentIndex > 0) {
            // Mover de uno en uno para mejor control
            this.currentIndex = Math.max(0, this.currentIndex - 1);
            this.updateCarousel();
            this.updateButtons();
        }
    }

    next() {
        if (this.currentIndex < this.maxIndex) {
            this.currentIndex = Math.min(this.maxIndex, this.currentIndex + 1);
            this.updateCarousel();
            this.updateButtons();
        }
    }

    updateCarousel() {
        if (this.items.length === 0) return;

        // Calcular la posición exacta
        const translateX = -(this.currentIndex * this.itemWidth);
        
        this.track.style.transform = `translateX(${translateX}px)`;
        
        // Debug info (puedes remover esto en producción)
        console.log({
            currentIndex: this.currentIndex,
            maxIndex: this.maxIndex,
            totalItems: this.totalItems,
            itemsPerView: this.itemsPerView,
            translateX: translateX,
            canMoveNext: this.currentIndex < this.maxIndex,
            canMovePrev: this.currentIndex > 0
        });
    }

    updateButtons() {
        // Botón anterior
        this.prevBtn.disabled = this.currentIndex === 0;
        this.prevBtn.style.opacity = this.currentIndex === 0 ? '0.5' : '1';
        
        // Botón siguiente
        this.nextBtn.disabled = this.currentIndex >= this.maxIndex;
        this.nextBtn.style.opacity = this.currentIndex >= this.maxIndex ? '0.5' : '1';
    }

    // Método para actualizar items dinámicamente
    updateItems() {
        this.items = Array.from(this.track.children);
        this.totalItems = this.items.length;
        this.maxIndex = this.calculateMaxIndex();
        this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
        this.updateCarousel();
        this.updateButtons();
    }

    // Método para ir a un índice específico
    goToIndex(index) {
        this.currentIndex = Math.max(0, Math.min(index, this.maxIndex));
        this.updateCarousel();
        this.updateButtons();
    }
}

// Función demo para simular click en producto
function goToProduct(element) {
    const productTitle = element.querySelector('.product-title').textContent;
    alert(`Navegando a: ${productTitle}`);
}

// Inicializar carousel cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', () => {
    const carousel = new ModernCarousel();
    
    // Exponer carousel globalmente para debugging (opcional)
    window.carousel = carousel;
});
</script>

</body>
</html>